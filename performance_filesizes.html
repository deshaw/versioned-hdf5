<!-- See https://github.com/bitprophet/alabaster/issues/166 -->

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Performance Analysis of VersionedHDF5 Files: File sizes &#8212; Versioned HDF5  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="I/O Performance for Versioned-HDF5 Files" href="performance_io.html" />
    <link rel="prev" title="Performance" href="performance.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="performance-analysis-of-versionedhdf5-files-file-sizes">
<span id="performance-filesizes"></span><h1>Performance Analysis of VersionedHDF5 Files: File sizes<a class="headerlink" href="#performance-analysis-of-versionedhdf5-files-file-sizes" title="Permalink to this heading">¶</a></h1>
<p>For these tests, we have generated <code class="docutils literal notranslate"><span class="pre">.h5</span></code> data files using the
<code class="docutils literal notranslate"><span class="pre">generate_data.py</span></code> script from the <a class="reference external" href="https://github.com/deshaw/versioned-hdf5">VersionedHDF5
repository</a>, using the
standard options (<a class="reference internal" href="performance.html#performance"><span class="std std-ref">see more details in Performance</span></a>.)</p>
<p>We performed the following tests:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#test-1-large-fraction-changes-sparse">Test Large Fraction Changes Sparse</a></p></li>
<li><p><a class="reference external" href="#test-2-mostly-appends-sparse">Test Mostly Appends Sparse</a></p></li>
<li><p><a class="reference external" href="#test-3-small-fraction-changes-sparse">Test Small Fraction Changes Sparse</a></p></li>
<li><p><a class="reference external" href="#test-4-large-fraction-changes-sparse-constant-size">Test Large Fraction Changes (Constant Array Size) Sparse</a></p></li>
<li><p><a class="reference external" href="#test-5-mostly-appends-dense">Test Mostly Appends Dense</a></p></li>
</ol>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">performance_tests</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<p>The information from the generated test files are stored in either</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">testcase.tests</span></code>, a dictionary containing all the info related to a testcase that was run recently;</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">.json</span></code> file named after the test name and options, containing a summary of the results. This file can be read with</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;&lt;filename&gt;.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_in</span><span class="p">:</span>
      <span class="n">test</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_in</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="test-1-large-fraction-changes-sparse">
<h2>Test 1: Large fraction changes (sparse)<a class="headerlink" href="#test-1-large-fraction-changes-sparse" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">testname</span> <span class="o">=</span> <span class="s2">&quot;test_large_fraction_changes_sparse&quot;</span>
</pre></div>
</div>
<p>For the number of transactions, chunk sizes and compression algorithms, we tests the following options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num_transactions_1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">]</span>
<span class="n">exponents_1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<span class="n">compression_1</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="s2">&quot;lzf&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>(note that chunk sizes are taken as power of 2, so an exponent of <span class="math notranslate nohighlight">\(12\)</span> means that the chunk size is <span class="math notranslate nohighlight">\(2^12\)</span> or 4096.)</p>
<p>If you want to generate your own tests, you can modify the appropriate constants
for the desired tests, and run them on the notebook included in the <code class="code docutils literal notranslate"><span class="pre">analysis</span></code> directory of the VersionedHDF souces. <strong>Please keep in mind that file sizes can become very large for large numbers of transactions (above 5000
transactions).</strong></p>
<section id="analysis">
<h3>Analysis<a class="headerlink" href="#analysis" title="Permalink to this heading">¶</a></h3>
<p>First, let’s obtain some common parameters from the tests:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num_transactions</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_1</span><span class="p">]</span>
<span class="n">chunk_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_1</span><span class="p">]</span>
<span class="n">compression</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_1</span><span class="p">]</span>
<span class="n">filesizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_1</span><span class="p">])</span>
<span class="n">sizelabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size_label&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_1</span><span class="p">])</span>
<span class="n">max_no_versions</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_1_no_versions</span><span class="p">]))</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">))</span>
<span class="n">ncs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chunk_sizes</span><span class="p">))</span>
<span class="n">ncomp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">compression</span><span class="p">))</span>
</pre></div>
</div>
<p>We’ll start by analyzing how the <code class="docutils literal notranslate"><span class="pre">.h5</span></code> file sizes grow as the number
of versions grows.</p>
<p>Note that the array size also can also grow as the number of versions
grows, since each transaction is changing the original arrays by adding,
deleting and changing values in the original arrays. In order to compute
a (naive) theoretical lower bound on the file size, we can compute how
much space each version should take. However, this does not account for
overhead and particular details of chunking. Keep in mind there is
redundant data as some of it is not changed during the staging of a new
version but it is still being stored.</p>
<p>Let’s show the size information in a plot. On the left, we can see a
linear plot, and on the right a loglog plot of the same size data for
<code class="docutils literal notranslate"><span class="pre">testcase_1</span></code>. On the bottom, a blue solid horizontal line indicates
the maximum file size obtained when generating the same tests with no
versioning (that is, not using VersionedHDF5).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># Changing the indices in selected will change the y-axis ticks in the graph for better visualization</span>
<span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                   <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                   <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">max_no_versions</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">max_no_versions</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_34_0.png" src="_images/Performance_tests-File_sizes_34_0.png" />
</section>
<section id="comparing-compression-algorithms">
<h3>Comparing compression algorithms<a class="headerlink" href="#comparing-compression-algorithms" title="Permalink to this heading">¶</a></h3>
<p>For each chunk size that we chose to test, let’s compare the file sizes
corresponding to each compression algorithm that we used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncs</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: File sizes&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chunk Size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_37_0.png" src="_images/Performance_tests-File_sizes_37_0.png" />
</section>
<section id="comparing-chunk-sizes">
<h3>Comparing chunk sizes<a class="headerlink" href="#comparing-chunk-sizes" title="Permalink to this heading">¶</a></h3>
<p>Now, for each choice of compression algorithm, we compare different
chunk sizes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncomp</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: File sizes&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plotlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">plottitle</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Compression: </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">plotlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">plottitle</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_40_0.png" src="_images/Performance_tests-File_sizes_40_0.png" />
</section>
<section id="creation-times">
<h3>Creation times<a class="headerlink" href="#creation-times" title="Permalink to this heading">¶</a></h3>
<p>If we look at the creation times for these files, we have something like
this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_1</span><span class="p">])</span>
<span class="n">fig_large_fraction_changes_times</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                 <span class="n">t_write</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                 <span class="s1">&#39;o--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># If you also with to plot information about the &quot;no versions&quot; test,</span>
<span class="c1"># run the following lines:</span>
<span class="n">t_write_nv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_1_no_versions</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                 <span class="n">t_write_nv</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                 <span class="s1">&#39;*-&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">, No versioning&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2"> - creation times in seconds&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_43_0.png" src="_images/Performance_tests-File_sizes_43_0.png" />
<p>Now, we can look at the time required to stage a new version in the
file, that is, to add a new transaction. The graphs below show, for each
fixed number of transactions, the time required to add new versions as
the file is created.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig_times</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">fig_times</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: time to write each new version&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_transactions</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_write</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;chunk size </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="c1"># If you also with to plot information about the &quot;no versions&quot; test,</span>
<span class="c1"># run the following lines:</span>
<span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_1_no_versions</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_transactions</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_write</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;chunk size </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;No versioning&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Time (in seconds)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_45_0.png" src="_images/Performance_tests-File_sizes_45_0.png" />
</section>
<section id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">¶</a></h3>
<p>We can clearly see that files with smallest file size, corresponding to
smaller chunk sizes, are also the ones with largest creation times.
<strong>This is consistent with the effects of using smaller chunk sizes in
HDF5 files.</strong></p>
<p>This behaviour suggests that for <code class="docutils literal notranslate"><span class="pre">test_large_fraction_changes_sparse</span></code>,
larger chunk sizes generate larger files, but the size of the files
grows as expected as the number of transactions grow. So, <strong>if we are
dealing with a large number of transactions, larger chunk sizes generate
files that are larger while having faster creation times</strong> (and probably
faster read/write speeds as well).</p>
</section>
</section>
<section id="test-2-mostly-appends-sparse">
<h2>Test 2: Mostly appends (sparse)<a class="headerlink" href="#test-2-mostly-appends-sparse" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">testname</span> <span class="o">=</span> <span class="s2">&quot;test_mostly_appends_sparse&quot;</span>
</pre></div>
</div>
<p>For this case, we have tested the following options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num_transactions_2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="n">exponents_2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<span class="n">compression_2</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="s2">&quot;lzf&quot;</span><span class="p">]</span>
</pre></div>
</div>
<section id="id1">
<h3>Analysis<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<p>Repeating the same analysis as in the previous test, let’s show the size
information in a graph:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num_transactions</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_2</span><span class="p">]</span>
<span class="n">chunk_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_2</span><span class="p">]</span>
<span class="n">compression</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_2</span><span class="p">]</span>
<span class="n">filesizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_2</span><span class="p">])</span>
<span class="n">sizelabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size_label&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_2</span><span class="p">])</span>
<span class="n">max_no_versions</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_2_no_versions</span><span class="p">]))</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">))</span>
<span class="n">ncs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chunk_sizes</span><span class="p">))</span>
<span class="n">ncomp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">compression</span><span class="p">))</span>
</pre></div>
</div>
<p>Similarly to what we did before, on the left we can see a linear plot,
and on the right a loglog plot of the same size data for <code class="docutils literal notranslate"><span class="pre">testcase_2</span></code>.
A blue solid horizontal line indicates the maximum file size obtained
when generating the same tests with no versioning (that is, not using
VersionedHDF5).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                   <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                   <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>
        <span class="c1"># Changing the indices in selected will change the y-axis ticks in the graph for better visualization</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">max_no_versions</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">max_no_versions</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_70_0.png" src="_images/Performance_tests-File_sizes_70_0.png" />
</section>
<section id="id2">
<h3>Comparing compression algorithms<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<p>For each chunk size that we chose to test, let’s compare the file sizes
corresponding to each compression algorithm that we used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncs</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: File sizes&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chunk Size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_73_0.png" src="_images/Performance_tests-File_sizes_73_0.png" />
</section>
<section id="id3">
<h3>Comparing chunk sizes<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h3>
<p>Now, for each choice of compression algorithm, we compare different
chunk sizes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncomp</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: File sizes&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plotlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">plottitle</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Compression: </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">plotlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">plottitle</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_76_0.png" src="_images/Performance_tests-File_sizes_76_0.png" />
</section>
<section id="id4">
<h3>Creation times<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h3>
<p>The creation times for each file are as follows.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_2</span><span class="p">])</span>
<span class="n">fig_large_fraction_changes_times</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                 <span class="n">t_write</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                 <span class="s1">&#39;o--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># If you also with to plot information about the &quot;no versions&quot; test,</span>
<span class="c1"># run the following lines:</span>
<span class="n">t_write_nv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_2_no_versions</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                 <span class="n">t_write_nv</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                 <span class="s1">&#39;*-&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">, No versioning&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2"> - creation times in seconds&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_79_0.png" src="_images/Performance_tests-File_sizes_79_0.png" />
<p>Again, the graphs below show, for each fixed number of transactions, the
time required to add new versions as the file is created.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig_times</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">fig_times</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: time to write each new version&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_transactions</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_write</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;chunk size </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="c1"># If you also with to plot information about the &quot;no versions&quot; test,</span>
<span class="c1"># run the following lines:</span>
<span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_2_no_versions</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_transactions</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_write</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;chunk size </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;No versioning&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Time (in seconds)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_81_0.png" src="_images/Performance_tests-File_sizes_81_0.png" />
</section>
<section id="id5">
<h3>Summary<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h3>
<p>In this test, we can see that creation times are higher, which is
expected since the arrays in the dataset grow significantly in size from
one version to the next. Again, smaller chunk sizes correspond to
smaller file sizes, but larger creation times. However, in this case, we
can see there is a drop in performance when adding new versions as our
file grows. This can be seen as an effect of the increase in the data
size for each new version (since we are <em>mostly appending</em> data with
each new version) but <strong>can’t be explained by that alone</strong>, as evidenced
by the difference in scale between creation times for the versioned and
non-versioned cases.</p>
</section>
</section>
<section id="test-3-small-fraction-changes-sparse">
<h2>Test 3: Small fraction changes (sparse)<a class="headerlink" href="#test-3-small-fraction-changes-sparse" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">testname</span> <span class="o">=</span> <span class="s2">&quot;test_small_fraction_changes_sparse&quot;</span>
</pre></div>
</div>
<p>We have tested the following options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num_transactions_3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">]</span>
<span class="n">exponents_3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<span class="n">compression_3</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="s2">&quot;lzf&quot;</span><span class="p">]</span>
</pre></div>
</div>
<section id="id6">
<h3>Analysis<a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h3>
<p>Again, let’s show the size information in a graph:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num_transactions</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_3</span><span class="p">]</span>
<span class="n">chunk_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_3</span><span class="p">]</span>
<span class="n">compression</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_3</span><span class="p">]</span>
<span class="n">filesizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_3</span><span class="p">])</span>
<span class="n">sizelabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size_label&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_3</span><span class="p">])</span>
<span class="n">max_no_versions</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_3_no_versions</span><span class="p">]))</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">))</span>
<span class="n">ncs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chunk_sizes</span><span class="p">))</span>
<span class="n">ncomp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">compression</span><span class="p">))</span>
</pre></div>
</div>
<p>Again, on the left we can see a linear plot, and on the right a loglog
plot of the same size data for <code class="docutils literal notranslate"><span class="pre">testcase_3</span></code>. A blue solid horizontal
line indicates the maximum file size obtained when generating the same
tests with no versioning (that is, not using VersionedHDF5).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># Changing the indices in selected will change the y-axis ticks in the graph for better visualization</span>
<span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                   <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                   <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">max_no_versions</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">max_no_versions</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_105_0.png" src="_images/Performance_tests-File_sizes_105_0.png" />
</section>
<section id="id7">
<h3>Comparing compression algorithms<a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h3>
<p>For each chunk size that we chose to test, let’s compare the file sizes
corresponding to each compression algorithm that we used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncs</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: File sizes&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chunk Size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_108_0.png" src="_images/Performance_tests-File_sizes_108_0.png" />
</section>
<section id="id8">
<h3>Comparing chunk sizes<a class="headerlink" href="#id8" title="Permalink to this heading">¶</a></h3>
<p>Now, for each choice of compression algorithm, we compare different
chunk sizes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncomp</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: File sizes&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plotlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">plottitle</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Compression: </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">plotlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">plottitle</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_111_0.png" src="_images/Performance_tests-File_sizes_111_0.png" />
</section>
<section id="id9">
<h3>Creation times<a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h3>
<p>If we look at the creation times for these files, we have something like
this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_3</span><span class="p">])</span>
<span class="n">fig_large_fraction_changes_times</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                 <span class="n">t_write</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                 <span class="s1">&#39;o--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># If you also with to plot information about the &quot;no versions&quot; test,</span>
<span class="c1"># run the following lines:</span>
<span class="n">t_write_nv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_3_no_versions</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                 <span class="n">t_write_nv</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                 <span class="s1">&#39;*-&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">, No versioning&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2"> - creation times in seconds&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_114_0.png" src="_images/Performance_tests-File_sizes_114_0.png" />
<p>Again, the graphs below show, for each fixed number of transactions, the
time required to add new versions as the file is created.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig_times</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">fig_times</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: time to write each new version&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_3</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_transactions</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_write</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;chunk size </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="c1"># If you also with to plot information about the &quot;no versions&quot; test,</span>
<span class="c1"># run the following lines:</span>
<span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_3_no_versions</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_transactions</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_write</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;chunk size </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;No versioning&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Time (in seconds)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_116_0.png" src="_images/Performance_tests-File_sizes_116_0.png" />
</section>
<section id="id10">
<h3>Summary<a class="headerlink" href="#id10" title="Permalink to this heading">¶</a></h3>
<p>This behaviour is very similar to what we got in the
<code class="docutils literal notranslate"><span class="pre">test_large_fraction_changes_sparse</span></code> case, with the exception that the
times required to write new versions to the file are on average smaller
than those in the former case. This is expected both in the versioned
and unversioned case.</p>
</section>
</section>
<section id="test-4-large-fraction-changes-constant-array-size-sparse">
<h2>Test 4: Large fraction changes - constant array size (sparse)<a class="headerlink" href="#test-4-large-fraction-changes-constant-array-size-sparse" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">testname</span> <span class="o">=</span> <span class="s2">&quot;test_large_fraction_constant_sparse&quot;</span>
</pre></div>
</div>
<p>We have tested the following options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num_transactions_4</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">]</span>
<span class="n">exponents_4</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
<span class="n">compression_4</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="s2">&quot;lzf&quot;</span><span class="p">]</span>
</pre></div>
</div>
<section id="id11">
<h3>Analysis<a class="headerlink" href="#id11" title="Permalink to this heading">¶</a></h3>
<p>Again, let’s show the size information in a graph:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num_transactions</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_4</span><span class="p">]</span>
<span class="n">chunk_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_4</span><span class="p">]</span>
<span class="n">compression</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_4</span><span class="p">]</span>
<span class="n">filesizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_4</span><span class="p">])</span>
<span class="n">sizelabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size_label&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_4</span><span class="p">])</span>
<span class="n">max_no_versions</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_4_no_versions</span><span class="p">]))</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">))</span>
<span class="n">ncs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chunk_sizes</span><span class="p">))</span>
<span class="n">ncomp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">compression</span><span class="p">))</span>
</pre></div>
</div>
<p>Again, on the left we can see a linear plot, and on the right a loglog
plot of the same size data for <code class="docutils literal notranslate"><span class="pre">testcase_4</span></code>. A blue solid horizontal
line indicates the maximum file size obtained when generating the same
tests with no versioning (that is, not using VersionedHDF5).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                   <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                   <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>
        <span class="c1"># Changing the indices in selected will change the y-axis ticks in the graph for better visualization</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">max_no_versions</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">max_no_versions</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_140_0.png" src="_images/Performance_tests-File_sizes_140_0.png" />
</section>
<section id="id12">
<h3>Comparing compression algorithms<a class="headerlink" href="#id12" title="Permalink to this heading">¶</a></h3>
<p>For each chunk size that we chose to test, let’s compare the file sizes
corresponding to each compression algorithm that we used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncs</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: File sizes&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chunk Size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_143_0.png" src="_images/Performance_tests-File_sizes_143_0.png" />
</section>
<section id="id13">
<h3>Comparing chunk sizes<a class="headerlink" href="#id13" title="Permalink to this heading">¶</a></h3>
<p>Now, for each choice of compression algorithm, we compare different
chunk sizes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncomp</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: File sizes&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plotlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">plottitle</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Compression: </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">plotlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">plottitle</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_146_0.png" src="_images/Performance_tests-File_sizes_146_0.png" />
</section>
<section id="id14">
<h3>Creation times<a class="headerlink" href="#id14" title="Permalink to this heading">¶</a></h3>
<p>If we look at the creation times for these files, we have something like
this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_4</span><span class="p">])</span>
<span class="n">fig_large_fraction_changes_times</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                 <span class="n">t_write</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                 <span class="s1">&#39;o--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># If you also with to plot information about the &quot;no versions&quot; test,</span>
<span class="c1"># run the following lines:</span>
<span class="n">t_write_nv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_4_no_versions</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                 <span class="n">t_write_nv</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                 <span class="s1">&#39;*-&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">, No versioning&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2"> - creation times in seconds&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_149_0.png" src="_images/Performance_tests-File_sizes_149_0.png" />
<p>Again, the graphs below show, for each fixed number of transactions, the
time required to add new versions as the file is created.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig_times</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">fig_times</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: time to write each new version&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_4</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_transactions</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_write</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;chunk size </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="c1"># If you also with to plot information about the &quot;no versions&quot; test,</span>
<span class="c1"># run the following lines:</span>
<span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_4_no_versions</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_transactions</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_write</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;chunk size </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;No versioning&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Time (in seconds)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_151_0.png" src="_images/Performance_tests-File_sizes_151_0.png" />
<p>This behaviour is again very similar to <code class="docutils literal notranslate"><span class="pre">test_large_fraction_changes</span></code>,
except that we don’t see the tendency to have larger times required to
add new versions as the number of transactions grows.</p>
</section>
</section>
<section id="test-5-mostly-appends-dense">
<h2>Test 5: Mostly appends (dense)<a class="headerlink" href="#test-5-mostly-appends-dense" title="Permalink to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">testname</span> <span class="o">=</span> <span class="s2">&quot;test_mostly_appends_dense&quot;</span>
</pre></div>
</div>
<p><strong>Note that this case includes a two-dimensional dataset.</strong> For this
reason, we have chosen different chunk sizes to test, considering that
larger chunk sizes increase file sizes considerably in this case.</p>
<p>For this case, we have tested the following options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num_transactions_5</span> <span class="o">=</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
<span class="n">exponents_5</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">compression_5</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="s2">&quot;lzf&quot;</span><span class="p">]</span>
</pre></div>
</div>
<section id="id15">
<h3>Analysis<a class="headerlink" href="#id15" title="Permalink to this heading">¶</a></h3>
<p>Let’s show the size information in a graph:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num_transactions</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_5</span><span class="p">]</span>
<span class="n">chunk_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_5</span><span class="p">]</span>
<span class="n">compression</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_5</span><span class="p">]</span>
<span class="n">filesizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_5</span><span class="p">])</span>
<span class="n">sizelabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size_label&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_5</span><span class="p">])</span>
<span class="n">max_no_versions</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_5_no_versions</span><span class="p">]))</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">))</span>
<span class="n">ncs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">chunk_sizes</span><span class="p">))</span>
<span class="n">ncomp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">compression</span><span class="p">))</span>
</pre></div>
</div>
<p>Once more, on the left we can see a linear plot, and on the right a
loglog plot of the same size data for <code class="docutils literal notranslate"><span class="pre">testcase_5</span></code>. A blue solid
horizontal line indicates the maximum file size obtained when generating
the same tests with no versioning (that is, not using VersionedHDF5).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">selected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                   <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                   <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>
        <span class="c1"># Changing the indices in selected will change the y-axis ticks in the graph for better visualization</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">max_no_versions</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">max_no_versions</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_173_0.png" src="_images/Performance_tests-File_sizes_173_0.png" />
</section>
<section id="id16">
<h3>Comparing compression algorithms<a class="headerlink" href="#id16" title="Permalink to this heading">¶</a></h3>
<p>For each chunk size that we chose to test, let’s compare the file sizes
corresponding to each compression algorithm that we used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncs</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: File sizes&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chunk Size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_176_0.png" src="_images/Performance_tests-File_sizes_176_0.png" />
</section>
<section id="id17">
<h3>Comparing chunk sizes<a class="headerlink" href="#id17" title="Permalink to this heading">¶</a></h3>
<p>Now, for each choice of compression algorithm, we compare different
chunk sizes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncomp</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: File sizes&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plotlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">plottitle</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Compression: </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                     <span class="n">filesizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                     <span class="s1">&#39;*--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">plotlabel</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">plottitle</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">filesizes</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">sizelabels</span><span class="p">[</span><span class="n">selected</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_179_0.png" src="_images/Performance_tests-File_sizes_179_0.png" />
</section>
<section id="id18">
<h3>Creation times<a class="headerlink" href="#id18" title="Permalink to this heading">¶</a></h3>
<p>If we look at the creation times for these files, we have something like
this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_5</span><span class="p">])</span>
<span class="n">fig_large_fraction_changes_times</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                 <span class="n">t_write</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                 <span class="s1">&#39;o--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># If you also with to plot information about the &quot;no versions&quot; test,</span>
<span class="c1"># run the following lines:</span>
<span class="n">t_write_nv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_5_no_versions</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">ncs</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span>
                 <span class="n">t_write_nv</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">:</span><span class="n">start</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">],</span>
                 <span class="s1">&#39;*-&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chunk size </span><span class="si">{</span><span class="n">chunk_sizes</span><span class="p">[</span><span class="n">start</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">n</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">compression</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="si">}</span><span class="s2">, No versioning&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2"> - creation times in seconds&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">num_transactions</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_182_0.png" src="_images/Performance_tests-File_sizes_182_0.png" />
<p>Again, the graphs below show, for each fixed number of transactions, the
time required to add new versions as the file is created.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig_times</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">fig_times</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">testname</span><span class="si">}</span><span class="s2">: time to write each new version&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_5</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_transactions</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_write</span><span class="p">,</span>
                       <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;chunk size </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="c1"># If you also with to plot information about the &quot;no versions&quot; test,</span>
<span class="c1"># run the following lines:</span>
<span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">testcase_5_no_versions</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;num_transactions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_transactions</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="n">t_write</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;t_write&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_write</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;chunk size </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;chunk_size&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;compression&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;No versioning&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of transactions&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Time (in seconds)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Performance_tests-File_sizes_184_0.png" src="_images/Performance_tests-File_sizes_184_0.png" />
</section>
<section id="id19">
<h3>Summary<a class="headerlink" href="#id19" title="Permalink to this heading">¶</a></h3>
<p>This test case is unique for a few reasons. First, having a
two-dimensional dataset introduces new considerations, such as the
number of rows being added in each axis. For this test case, we have
only added (few) new rows to the first axis with each new version, and
this might explain why we don’t see an increase in the time required to
write new versions to file as the number of transactions grow. In
addition, we can see that in the case of 500 transactions, the creation
of the unversioned file can also take a hit in performance. These are
preliminary tests, and multidimensional datasets are still experimental
at this point in VersionedHDF5.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Versioned HDF5</a></h1>










    

<p>
<a class="badge" href="https://travis-ci.org/deshaw/versioned-hdf5">
    <img
        alt="https://secure.travis-ci.org/deshaw/versioned-hdf5.svg?branch=master"
        src="https://secure.travis-ci.org/deshaw/versioned-hdf5.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="performance.html">Performance</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Performance Analysis of VersionedHDF5 Files: File sizes</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance_io.html">I/O Performance for Versioned-HDF5 Files</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Versioned HDF5 Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="releasing.html">Releasing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="performance.html">Performance</a><ul>
      <li>Previous: <a href="performance.html" title="previous chapter">Performance</a></li>
      <li>Next: <a href="performance_io.html" title="next chapter">I/O Performance for Versioned-HDF5 Files</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    
    <div class="footer">
      &copy;2020, Quansight.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/performance_filesizes.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
    <span id="forkongithub"><a href="https://github.com/deshaw/versioned-hdf5">Fork me on GitHub</a></span>
  </body>
</html>